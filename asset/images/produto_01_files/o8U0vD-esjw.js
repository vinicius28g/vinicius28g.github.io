;/*FB_PKG_DELIM*/

__d("LSGetFirstAvailableAdminMessageCTAID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(a){return b.sequence([function(a){return b.db.table(27).fetchDesc([[[]],"ctaId"]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=b.i64.cast([0,1]):(d=a.item,c[0]=b.i64.add(d.ctaId,b.i64.cast([0,1])))})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSApplyAdminMessageCTA",["LSGetFirstAvailableAdminMessageCTAID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetFirstAvailableAdminMessageCTAID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(27).put({threadKey:a[0],messageId:a[2],ctaId:d[0],timestampMs:a[1],adClientToken:a[5],adPreferenceUrl:a[6],adHelpUrl:a[7],showAdChoiceIcon:a[8],title:a[3],actionUrl:a[9],adminMessageNicknameParticipantId:a[10],targetId:a[11],targetTitle:a[12]})},function(b){return void 0?d[1]=!1:d[1]=!0,d[1]?0:(d[4]=new c.Map(),d[4].set("ad_client_token",a[5]),d[4].set("ad_preference_url",a[6]),d[4].set("ad_help_url",a[7]),d[4].set("show_ad_choice_icon",a[8]),d[4].set("title",a[3]),d[4].set("action_url",a[9]),d[4].set("admin_message_nickname_participant_id",c.i64.to_string(a[10])),d[4].set("target_id",c.i64.to_string(a[11])),d[4].set("target_title",a[12]),d[4].set("identifier_name",void 0),(void 0).set("admin_message",d[4])),void 0?d[2]=!1:d[2]=!0,d[2]?d[3]=void 0:(d[4]=c.toJSON(void 0),d[3]=d[4]),c.forEach(c.filter(c.db.table(12).fetch([[[a[0],a[1],a[2]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.timestampMs,a[1])&&b.messageId===a[2]}),function(b){var c=b.update;b.item;return c({adminMsgCtaId:d[0],adminMsgCtaTitle:a[3],adminMsgCtaType:a[4]})})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);